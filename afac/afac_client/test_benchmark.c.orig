#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>
#include <fcntl.h>

#define ACCESS_UNIT 1024*1024

int main(int argc, char *argv[])
{
	if(argc != 4)
	{
		printf("useage: main read/write blk_size_in_kb blk_count\n");
		return 0;
	}
	int read_or_write = atoi(argv[1]);
	double blk_size_in_kb = atof(argv[2]);
	int blk_count = atoi(argv[3]);

	int fd = open("/WORK/home/yujie/yujie/afac/afac_client/jay_test_file.dat", O_RDWR);

	// init the write out blk
	unsigned long blk_size = 1024L * blk_size_in_kb / sizeof(unsigned long);
	unsigned long write_out_buf[blk_size];
	int i;
	for(i=0; i<blk_size; i++)
	{
		write_out_buf[i] = i;
	}

	unsigned long read_in_buf[blk_size];
	// read
	if(read_or_write)
	{
		for(i=0; i<blk_count; i++)
		{
			read(fd, read_in_buf, blk_size * sizeof(unsigned long));
		}

	for(i=0; i<blk_count * blk_size; i++)
	{
		if(i%100000 == 0)
			printf("%llu\n", (unsigned long*)read_in_buf[i]);
	}
	}
	// write
	else
	{
		for(i=0; i<blk_count; i++)
		{
			write(fd, write_out_buf, blk_size * sizeof(unsigned long));
		}

	for(i=0; i<blk_count * blk_size; i++)
	{
		if(i%100000 == 0)
			printf("%llu\n", (unsigned long*)write_out_buf[i]);
	}
	}
}
